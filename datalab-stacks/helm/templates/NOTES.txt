{{/*- Check if there is a secret already deployed (e.g. user used helm install --wait) */}}
{{- $secret := (lookup "v1" "Secret" .Release.Namespace (include "common.names.fullname" .)) }}
{{- if eq .Release.Namespace "default" }}

!! BE AWARE THAT IT IS NOT RECOMMENDED TO INSTALL THIS CHART INTO THE DEFAULT NAMESPACE !!

To remove the Helm chart again immediately:

    helm uninstall {{ .Release.Name }}

You might have to delete additional Kubernetes secrets, PVCs and other ressources MANUALLY. Especially PVCs might prevent you to redeploy the Helm chart later. Check the remaining ressources with

    kubectl get secrets -n {{ .Release.Namespace }} -l 'app.kubernetes.io/instance={{ .Release.Name }}'
    kubectl get pvc -n {{ .Release.Namespace }} -l 'app.kubernetes.io/instance={{ .Release.Name }}'

Then delete all of them with

    kubectl delete secrets -n {{ .Release.Namespace }} -l 'app.kubernetes.io/instance={{ .Release.Name }}'
    kubectl delete pvc -n {{ .Release.Namespace }} -l 'app.kubernetes.io/instance={{ .Release.Name }}'


{{ end }}

Jupyterlab
==========
{{- if $secret }}
Use the following URL to access your Jupyter notebook:

  http://localhost/{{ .Release.Name }}?token={{ index $secret.data "jupyterToken" | b64dec }}

{{- else}}

Kubernetes secret for Jupyter token has not been fully deployed yet. To get
the correct URL for your Jupyter notebook, simply re-try the exact same
command you just used, e.g. "helm install" or "helm upgrade", in a few
seconds

{{- end}}
{{- if .Values.postgresql.enabled }}

PostgreSQL
==========
Use the following credentials to connect from your Jupyter notebook:

    host: postgresql (name of the Kubernetes mysql Service in the namespace {{ .Release.Namespace }})
    port: {{ .Values.postgresql.primary.service.ports.postgresql }}

{{- $secretpostgresql := (lookup "v1" "Secret" .Release.Namespace (.Values.postgresql.auth.existingSecret)) }}
{{- if and ($secretpostgresql) (.Values.postgresql.auth.existingSecret) }}
    Admin: password for user "admin": {{ index $secretpostgresql.data "postgres-password" | b64dec }}
    Normal user: password for user "{{ .Values.postgresql.auth.username }}": {{ index $secretpostgresql.data "password" | b64dec }}
    Replication: password for user "{{ .Values.postgresql.auth.replicationUsername }}": {{ index $secretpostgresql.data "replication-password" | b64dec }}

{{- else if not (.Values.postgresql.auth.existingSecret) }}

You set the PostgreSQL passwords yourself, so you should know what you're doing.
{{- else }}

Kubernetes secret for your PostgreSQL password has not been fully deployed
yet. Try the exact same "helm install" or "helm upgrade --install" command
again in a few seconds to display your PostgreSQL credentials. 

{{- end }}
{{- end }}
{{- if .Values.mysql.enabled }}

MySQL
=====
Use the following credentials to connect from your Jupyter notebook:

    host: mysql (name of the Kubernetes mysql Service in the namespace {{ .Release.Namespace }})
    port: {{ .Values.mysql.primary.service.ports.mysql }}

{{- $secretmysql := (lookup "v1" "Secret" .Release.Namespace (.Values.mysql.auth.existingSecret)) }}
{{- if and ($secretmysql) (.Values.mysql.auth.existingSecret) }}
    Admin: password for user "root": {{ index $secretmysql.data "mysql-root-password" | b64dec }}
    Normal user: password for user "{{ .Values.mysql.auth.username }}": {{ index $secretmysql.data "mysql-password" | b64dec }}
    Replication: password for user "{{ .Values.mysql.auth.replicationUser }}": {{ index $secretmysql.data "mysql-replication-password" | b64dec }}

{{- else if not (.Values.mysql.auth.existingSecret) }}

You set the MySQL passwords yourself, so you should know what you're doing.
{{- else }}

Kubernetes secret for your MySQL password has not been fully deployed
yet. Try the exact same "helm install" or "helm upgrade --install" command
again in a few seconds to display your MySQL credentials. 

{{- end }}
{{- end }}
{{- if ne .Release.Namespace "default" }}

CLEANUP
=======
If you want to completely clean up your Kubernetes resources, do the following:
1) Delete the helm chart (this will leave secrets and PVCs intact):

    helm uninstall -n {{ .Release.Namespace }} {{ .Release.Name }}

2) Delete the entire namespace (to also delete e.g. secrets with the Jupyter
   token or database credentials as well as PVCs):

    kubectl delete namespace {{ .Release.Namespace }}

{{ end }}